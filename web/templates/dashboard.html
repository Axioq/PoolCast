<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>PoolCast Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 2rem; background: #1e1e2f; color: #e0e0e0; }
        h1 { margin-bottom: 1rem; }
        .controls { margin-bottom: 1rem; }
        .controls select, .controls button {
            margin-right: 1rem;
            padding: 0.5rem;
            font-size: 1rem;
        }
    </style>
</head>
<body>

<h1>PoolCast Dashboard</h1>

<div class="controls">
    <form method="get" style="display: inline;">
        <label for="range">Time Range:</label>
        <select name="range" id="range" onchange="this.form.submit()">
            <option value="24h" {% if time_range == '24h' %}selected{% endif %}>24 Hours</option>
            <option value="7d" {% if time_range == '7d' %}selected{% endif %}>7 Days</option>
            <option value="30d" {% if time_range == '30d' %}selected{% endif %}>30 Days</option>
            <option value="1y" {% if time_range == '1y' %}selected{% endif %}>1 Year</option>
        </select>
    </form>

    <button onclick="toggleUnits()">Toggle °F / °C</button>
</div>

<canvas id="tempChart" height="80"></canvas>

<script>
    const readings = {{ readings|tojson }};
    const labels = readings.map(r => new Date(r[0]).toLocaleString());

    const dataF = {
        pool: readings.map(r => r[1]),
        weather: readings.map(r => r[2])
    };

    const dataC = {
        pool: readings.map(r => r[3]),
        weather: readings.map(r => r[4])
    };

    let currentUnit = 'F';

    const ctx = document.getElementById('tempChart').getContext('2d');
    const chart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [
                {
                    label: 'Pool Temp (°F)',
                    data: dataF.pool,
                    borderColor: 'blue',
                    fill: false,
                    tension: 0.1
                },
                {
                    label: 'Weather Temp (°F)',
                    data: dataF.weather,
                    borderColor: 'orange',
                    fill: false,
                    tension: 0.1
                }
            ]
        },
        options: {
            responsive: true,
            scales: {
                x: { ticks: { maxTicksLimit: 10 }, title: { display: true, text: 'Time' }},
                y: { title: { display: true, text: 'Temperature' }}
            }
        }
    });

    function toggleUnits() {
        if (currentUnit === 'F') {
            chart.data.datasets[0].data = dataC.pool;
            chart.data.datasets[1].data = dataC.weather;
            chart.data.datasets[0].label = 'Pool Temp (°C)';
            chart.data.datasets[1].label = 'Weather Temp (°C)';
            currentUnit = 'C';
        } else {
            chart.data.datasets[0].data = dataF.pool;
            chart.data.datasets[1].data = dataF.weather;
            chart.data.datasets[0].label = 'Pool Temp (°F)';
            chart.data.datasets[1].label = 'Weather Temp (°F)';
            currentUnit = 'F';
        }
        chart.update();
    }
</script>
</body>
</html>